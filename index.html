<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>네트급여 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:'Inter',sans-serif;background:#f3f4f6}
    .tab-btn{ @apply px-4 py-2 text-sm font-semibold border-b-2 border-transparent; }
    .tab-active{ @apply font-bold text-blue-600 border-blue-600; }
  </style>
</head>
<body class="p-4 bg-gray-100 flex items-center justify-center min-h-screen">

  <div class="bg-white rounded-2xl shadow-xl p-0 max-w-6xl w-full">
    <!-- 탭 헤더 -->
    <div class="border-b px-6 pt-4">
      <h1 class="text-3xl font-bold text-gray-800 text-center mb-6">네트급여 계산기</h1>
      <div class="flex items-center justify-center gap-4 mb-2">
        <button id="tab_single" class="tab-btn tab-active text-gray-500">단일</button>
        <button id="tab_multi"  class="tab-btn text-gray-500">다중</button>
        <span class="ml-auto text-xs text-gray-500">
          <button id="ver_btn" type="button" class="inline-flex items-center text-blue-600 font-semibold underline hover:text-blue-800">
            Ver 1.0
          </button>
        </span>
      </div>
    </div>

    <!-- 단일 계산식 -->
    <div id="content_single" class="px-6 pb-6">
      <!-- 입력 -->
      <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-gray-700 font-semibold mb-2">실수령액 (원)</label>
          <input id="net_pay" type="text" inputmode="numeric"
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                 placeholder="예: 11,350,000">
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-2">비과세 합계(월)</label>
          <input id="nontax" type="text" inputmode="numeric"
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                 placeholder="예: 200,000 (없으면 0)">
          <p id="table_status" class="text-[11px] text-gray-400 mt-1">세액표 불러오는 중…</p>
        </div>
      </div>

      <button id="calc_btn"
              class="mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
              disabled>계산하기</button>

      <!-- 결과 -->
      <div id="result" class="bg-gray-50 rounded-lg p-6 hidden mt-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">계산 결과</h2>

        <!-- 지급총액 / 공제액 합계 -->
        <div class="grid grid-cols-2 gap-2 text-sm">
          <div class="bg-white rounded-lg border p-3">
            <div class="text-gray-600">지급총액</div>
            <div id="gross_pay_result" class="font-semibold text-gray-900 mt-1"></div>
          </div>
          <div class="bg-white rounded-lg border p-3">
            <div class="text-gray-600">공제액 합계</div>
            <div id="deductions_total_result" class="font-semibold text-gray-900 mt-1"></div>
          </div>
        </div>

        <!-- 연봉 -->
        <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
          <div class="bg-white rounded-lg border p-3">
            <div class="text-gray-700 font-medium">연봉(퇴직금 제외)</div>
            <div id="annual_excl" class="font-semibold text-gray-900 mt-1"></div>
            <div class="text-[11px] text-gray-500 mt-1">(= 지급총액 × 12)</div>
          </div>
          <div class="bg-white rounded-lg border p-3">
            <div class="text-gray-700 font-medium">연봉(퇴직금 포함)</div>
            <div id="annual_incl" class="font-semibold text-gray-900 mt-1"></div>
            <div class="text-[11px] text-gray-500 mt-1">(= 지급총액 × 13)</div>
          </div>
        </div>

        <!-- 총부담액 -->
        <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
          <div class="bg-white rounded-lg border p-3">
            <div class="text-gray-700 font-medium">총부담액(퇴직금 제외)</div>
            <div id="total_burden_excl" class="font-semibold text-gray-900 mt-1"></div>
            <div class="text-[11px] text-gray-500 mt-1">실수령액 대비 <span id="total_burden_excl_pct"></span></div>
          </div>
          <div class="bg-white rounded-lg border p-3">
            <div class="text-gray-700 font-medium">총부담액(퇴직금 포함)</div>
            <div id="total_burden_incl" class="font-semibold text-gray-900 mt-1"></div>
            <div class="text-[11px] text-gray-500 mt-1">실수령액 대비 <span id="total_burden_incl_pct"></span></div>
          </div>
        </div>

        <!-- 수식형 요약 -->
        <div class="mt-6 space-y-1 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-700">+ 4대보험 총액(근로자+사업주)</span>
            <span id="social_total_summary" class="font-semibold text-gray-900"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-700">+ 원천세 총액</span>
            <span id="withholding_total_summary" class="font-semibold text-gray-900"></span>
          </div>
          <div class="border-t border-gray-300 my-1"></div>
          <div class="flex justify-between">
            <span class="text-gray-700">= 부대비용 총액(퇴직금 제외)</span>
            <span id="overhead_excl_gratuity" class="font-semibold text-gray-900"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-700">+ 퇴직금 (1/12)</span>
            <span id="gratuity_summary" class="font-semibold text-gray-900"></span>
          </div>
          <div class="border-t border-gray-300 my-1"></div>
          <div class="flex justify-between">
            <span class="text-gray-700">= 부대비용 총액(퇴직금 포함)</span>
            <span id="overhead_incl_gratuity" class="font-semibold text-gray-900"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- 다중 계산식 -->
    <div id="content_multi" class="px-6 pb-6 hidden">
      <div class="mt-6">
        <div class="flex items-center justify-between mb-2">
          <div class="text-sm text-gray-600">여러 실수령액/비과세 금액을 입력해 요약 확인</div>
          <div class="flex gap-2">
            <button id="add_row" class="px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg border">+ 행 추가</button>
            <button id="calc_multi" class="px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700">다중 계산</button>
          </div>
        </div>

        <div id="multi_inputs" class="space-y-2"></div>

        <div class="overflow-auto mt-4">
          <table class="w-full text-sm border border-gray-200 rounded-lg overflow-hidden">
            <thead class="bg-gray-50 text-gray-700">
              <tr>
                <th class="p-2 border-b">실수령액</th>
                <th class="p-2 border-b">비과세</th>
                <th class="p-2 border-b">지급총액</th>
                <th class="p-2 border-b">공제합계</th>
                <th class="p-2 border-b">연봉 <span class="text-xs text-gray-500">(퇴직금제외)</span></th>
                <th class="p-2 border-b">연봉 <span class="text-xs text-gray-500">(퇴직금포함)</span></th>
                <th class="p-2 border-b">총부담 <span class="text-xs text-gray-500">(퇴직금제외)</span></th>
                <th class="p-2 border-b whitespace-nowrap text-right">총부담% <span class="text-xs text-gray-500">(제외)</span></th>
                <th class="p-2 border-b">총부담 <span class="text-xs text-gray-500">(퇴직금포함)</span></th>
                <th class="p-2 border-b whitespace-nowrap text-right">총부담% <span class="text-xs text-gray-500">(포함)</span></th>
              </tr>
            </thead>
            <tbody id="multi_results" class="text-gray-800"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== 포맷 =====
    const fmt = n => new Intl.NumberFormat('ko-KR').format(Math.round(n))+' 원';
    const fmtPct = n => new Intl.NumberFormat('ko-KR',{minimumFractionDigits:1,maximumFractionDigits:1}).format(n)+' %';
    const num = el => parseFloat((el.value||'0').replace(/[^\d]/g,''))||0;
    const trunc10 = v => Math.floor(v/10)*10;
    const clamp = (x,lo,hi)=>Math.min(Math.max(x,lo),hi);
    const bindComma = el => el.addEventListener('input', e => {
      const d = e.target.value.replace(/[^\d]/g,'');
      e.target.value = d ? new Intl.NumberFormat('ko-KR').format(+d) : '';
    });

    // ===== 탭 =====
    const tabSingleBtn=document.getElementById('tab_single');
    const tabMultiBtn=document.getElementById('tab_multi');
    const contentSingle=document.getElementById('content_single');
    const contentMulti=document.getElementById('content_multi');
    function switchTab(which){
      if(which==='single'){
        tabSingleBtn.classList.add('tab-active');
        tabMultiBtn.classList.remove('tab-active');
        contentSingle.classList.remove('hidden');
        contentMulti.classList.add('hidden');
      }else{
        tabMultiBtn.classList.add('tab-active');
        tabSingleBtn.classList.remove('tab-active');
        contentMulti.classList.remove('hidden');
        contentSingle.classList.add('hidden');
      }
    }
    tabSingleBtn.addEventListener('click',()=>switchTab('single'));
    tabMultiBtn.addEventListener('click',()=>switchTab('multi'));

    // ===== 다중 입력 =====
    const multiInputs=document.getElementById('multi_inputs');
    function createRow(){
      const row=document.createElement('div');
      row.className='flex gap-2';
      row.innerHTML=`
        <input type="text" placeholder="실수령액" class="net-input w-40 px-3 py-2 border rounded-lg">
        <input type="text" placeholder="비과세" class="nontax-input w-40 px-3 py-2 border rounded-lg">
        <button class="remove-row px-3 py-2 text-sm border rounded-lg">삭제</button>`;
      multiInputs.appendChild(row);
      bindComma(row.querySelector('.net-input'));
      bindComma(row.querySelector('.nontax-input'));
      row.querySelector('.remove-row').addEventListener('click',()=>row.remove());
    }
    createRow();

    // TODO: 계산 로직은 단일 계산식에서 재사용 (생략)
  </script>
</body>
</html>
